// File is generated; DO NOT EDIT.

= ods-pipeline-image-package

Packages applications into container images using
link:https://buildah.io[buildah].

buildah builds a container image from the `docker-dir` directory using the
provided `dockerfile`.
The following `--build-arg` parameters are provided to enable convenient access
to Nexus:

* nexusUrl=${NEXUS_URL}
* nexusUsername=Escaped(${NEXUS_USERNAME})
* nexusPassword=Escaped(${NEXUS_PASSWORD})
* nexusHost=Host(${NEXUS_URL})
* nexusAuth=${nexusUsername}:$(nexusPassword)
* nexusUrlWithAuth=${nexusUrl.withAuth($nexusAuth)}

The above is adhoc notation meant to be more clear than a bunch of words.
If no nexusUsername/nexusPassword are defined nexusAuth will be empty and
nexusUrlWithAuth is equal to nexusUrl.

By default, the image is named after the component and pushed into the image
stream located in the namespace of the pipeline run.

An SBOM of the image is created using link:https://aquasecurity.github.io/trivy/v0.47/docs/[Trivy].

If the parameter `cosign-key` is specified, the image is signed with this key using link:https://docs.sigstore.dev/signing/quickstart/[cosign], and an attestation for the generated SBOM will be attached to the image.

Processes tags specified in the `extra-tags` parameter and adds missing tags to
the images stream in the namespace of the pipeline run.

The following artifacts are generated by the task and placed into `.ods/artifacts/`

* `image-digests/`
  ** `<image-name>.json`
  ** `<image-name>-<tag>.json` for each extra-tag
* `sboms/`
  ** `<image-name>.spdx`



== Parameters

[cols="1,1,2"]
|===
| Parameter | Default | Description

| registry
| image-registry.openshift-image-registry.svc:5000
| Image registry to push image to.


| image-stream
| 
| Reference of the image stream buildah will produce. If not set, the value of `.ods/component` is used.


| extra-tags
| 
| Additional image tags (e.g. 'latest dev') for pushed images. The primary tag is based on the commit sha. Only tags currently missing from the image will be added.


| storage-driver
| vfs
| Set buildah storage driver.


| dockerfile
| ./Dockerfile
| Path to the Dockerfile to build (relative to `docker-dir`).


| docker-dir
| .
| Path to the directory to use as Docker context.


| format
| oci
| The format of the built container, `oci` or `docker`.


| buildah-build-extra-args
| 
| Extra parameters passed for the build command when building images (e.g. '--build-arg=firstArg=one --build-arg=secondArg=two').


| buildah-push-extra-args
| 
| Extra parameters passed for the push command when pushing images.


| trivy-sbom-extra-args
| 
| Extra parameters passed for the trivy command to generate an SBOM.


| cosign-key
| 
| Cosign Key. When set, the image will be signed with cosign using the specified key.
To reference a K8s secret, use k8s://<namespace>/<secret>. The secret must have a field
named `cosign.pub` containing the public key.


|===

== Results

[cols="1,3"]
|===
| Name | Description

| image-digest
| Digest of the image just built (e.g. `sha256:406cf...f9109`).


| image-ref
| Image reference of the image just built (e.g. `image-registry.openshift-image-registry.svc:5000/foo-cd/bar@sha256:406cf...f9109`).

|===
